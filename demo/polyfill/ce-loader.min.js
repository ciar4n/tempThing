(function (window) {
	'use strict';

	var checkfunction() {
		"use strict";

		try { eval("var foo = (x)=>x+1"); }
		catch (e) { return false; }
		return true;
	}

	var name = 'ce-loader.js',
		script = document.querySelector('script[src*="' + name + '"]'),
		loadScript = function (scriptName) {
			var newScr = document.createElement('script');
			newScr.src = script.src.replace(name, scriptName);
			document.head.appendChild(newScr);
		};

	// Check if custom elements are natively supported
	if (!window.customElements) {
		loadScript('https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.0.0-rc.8/webcomponents-lite.js');
	}

	// Check if ES6 is ok
	if (check()) {
		console.log('is')
		loadScript('native-shim.min.js');
	} else {
		loadScript('native-shim-es5.min.js');
	}


})(window);

/**
 *
 * This code introduces an event similar to WebComponentsJs from Google
 * A patch in document-register-element.js is required:
 *
 * The last part `})(window);` needs to be replaced with:
 * `var evt=document.createEvent("HTMLEvents");evt.initEvent("WebComponentsReady", true, true);window.dispatchEvent(evt);})(window);`
 *
 * This is important due to async nature, and the ordering of the scripts!!!!
 */

// IE
(function (window) {
	function CustomEvent(event, params) {
		params = params || { bubbles: false, cancelable: false, detail: undefined };
		var evt = document.createEvent('CustomEvent');
		evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);
		return evt;
	};
	CustomEvent.prototype = window.CustomEvent.prototype;
	window.CustomEvent = CustomEvent;
})(window);
